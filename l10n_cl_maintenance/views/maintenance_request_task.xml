<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Actualización masiva-->
        <record id="action_massive_employee_update" model="ir.actions.server">
            <field name="name">Asignación Masiva de Empleado</field>
            <field name="model_id" ref="model_maintenance_request_task"/>
            <field name="binding_model_id" ref="l10n_cl_maintenance.model_maintenance_request_task"/>
            <field name="state">code</field>
            <field name="code">action = model.action_massive_employee_update()</field>
        </record>

        <record id="maintenance_request_task_view_form" model="ir.ui.view">
            <field name="name">maintenance_request_task_view_form</field>
            <field name="model">maintenance.request.task</field>
            <field name="arch" type="xml">
                <form string="maintenance_request_task_form">
                    <header>
                        <button class="btn-primary"
                                name="action_timer_start"
                                type="object" string="Start"
                                attrs="{'invisible': ['|', '|',('flag_timer', '=', True), ('display_timer_stop', '=', True), ('stage_id', 'in', (2,3))]}"
                                icon="fa-clock-o"/>
                        <button class="btn-secondary" name="action_timer_start" type="object" string="Start"
                                attrs="{'invisible': [ '|', '|',('display_timer_start_secondary', '=', False),
                                                            ('encode_uom_in_days', '=', True), ('stage_id', 'in', (2,3))
                                                      ]}"
                                icon="fa-clock-o"/>
                        <button class="btn-primary btn-danger o_fsm_stop" name="action_timer_stop"
                                type="object"
                                string="Stop"
                                attrs="{'invisible': ['|', ('display_timer_stop', '=', False),
                                                           ('encode_uom_in_days', '=', True)
                                                           ]}"
                                icon="fa-clock-o"/>
                        <button class="btn-primary" name="action_timer_pause" type="object" string="Pause"
                                attrs="{'invisible': ['|', ('display_timer_pause', '=', False), ('encode_uom_in_days', '=', True)]}"/>
                        <button class="btn-primary btn-info" name="action_timer_resume" type="object" string="Resume"
                                attrs="{'invisible': ['|', ('display_timer_resume', '=', False), ('encode_uom_in_days', '=', True)]}"/>

                        <field name="timer_start" widget="timer_timer"
                               class="text-danger ml-auto h2 ml-4 font-weight-bold"/>


                        <field name="stage_id" widget="statusbar"
                               class=">ml-2"
                               groups="l10n_cl_maintenance.group_jefe_planificacion,l10n_cl_maintenance.group_jefe_soporte_mtto,l10n_cl_maintenance.group_analista,l10n_cl_maintenance.group_ing_llantas_config,l10n_cl_maintenance.group_tecnicos"
                               options="{'clickable': '1', 'fold_field':'fold'}"/>
                    </header>
                    <sheet>
                        <field name="active" invisible="1"/>
                        <field name="flag_timer" invisible="1"/>
                        <field name="timer_pause" invisible="1"/>
                        <field name="display_timer_start_primary" invisible="1"/>
                        <field name="display_timer_start_secondary" invisible="1"/>
                        <field name="display_timer_stop" invisible="1"/>
                        <field name="display_timer_pause" invisible="1"/>
                        <field name="display_timer_resume" invisible="1"/>

                        <!--security restriccion-->
                        <field name="flag_readonly" invisible="1"/>


                        <widget name="web_ribbon" title="Archived" bg_color="bg-danger"
                                attrs="{'invisible': [('active', '=', True)]}"/>

                        <div class="oe_title pr-0">
                            <h4 class="d-flex flex-row text-break justify-content-between text-dark text-bf text-primary">
                                <field name="priority" widget="priority" class="mr-3"/>
                                <field name="name"
                                       class="o_task_name text-truncate"
                                       placeholder="Task Title..."/>
                                <field name="kanban_state" widget="state_selection" class="ml-auto"/>
                            </h4>
                        </div>
                        <div attrs="{'invisible': [('activity_speciality_ids', '=', [])]}">
                            <label for="activity_speciality_ids" string="Specialities"/>
                            <field
                                    name="activity_speciality_ids"
                                    widget="many2many_tags"
                                    options="{'color_field': 'color'}"
                                    placeholder="e.g. Mechanic"/>


                        </div>
                        <group>
                            <group>
                                <field name="flag_create_task" invisible="1"/>
                                <field name="request_id" style="color:red;font-weight: bold;"
                                       attrs="{'readonly': ['|', ('flag_create_task', '=', True), ('flag_from_request', '=', True)]}"
                                       options="{'no_create': True, 'no_create_edit': True, 'no_open': False}"/>

                                <field name="activity_id"
                                       attrs="{'readonly': ['|',('flag_create_task', '=', True),('flag_readonly', '=', True)],
                                               'required': [('flag_create_task', '=', False)]}"
                                       options="{'no_create': True, 'no_create_edit': True, 'no_open': False}"/>
                                <field name="flag_from_request" invisible="1"/>

                                <field name="employee_id"
                                       domain="[
                                                ('user_id', '!=', False),
                                                ('speciality_ids', 'in', activity_speciality_ids),
                                                '|', ('company_id', '=', False), ('company_id', '=', company_id)
                                       ]"
                                       options="{'no_create': True, 'no_create_edit': True, 'no_open': False}"
                                       attrs="{'readonly': [('flag_readonly', '=', True)]}"
                                       widget="many2one_avatar_employee"/>
                                <field name="request_equipment_id"
                                       string="Equipo"
                                       attrs="{'invisible': [('request_equipment_id', '=', False)]                                       }"
                                       options="{'no_create': True, 'no_create_edit': True, 'no_open': True}"/>
                            </group>
                            <group>
                                <field name="user_id" widget="many2one_avatar_user"/>
                                <label for="planned_date_begin" string="Planned Date"/>
                                <div class="w-100">
                                    <div class="o_row">
                                        <field name="planned_date_begin" widget="daterange"
                                               options='{"related_end_date": "planned_date_end"}'/>
                                        <i class="fa fa-long-arrow-right mx-2 oe_edit_only" aria-label="Arrow icon"
                                           title="Arrow"/>
                                        <i class="fa fa-long-arrow-right mx-2 oe_read_only" aria-label="Arrow icon"
                                           title="Arrow"
                                           attrs="{'invisible': [('planned_date_begin', '=', False), ('planned_date_end', '=', False)]}"/>
                                        <field name="planned_date_end" widget="daterange"
                                               options='{"related_start_date": "planned_date_begin"}'/>
                                    </div>
                                </div>
                                <field name="company_id" groups="base.group_multi_company"/>
                            </group>
                        </group>

                        <notebook>

                            <page name="description_page" string="Description">
                                <field name="description" type="html"/>
                                <div class="oe_clear"/>
                            </page>
                            <page name="page_detail_activity" string="Activity Detail"
                                  attrs="{'invisible': [('activity_id', '=', False)]}">
                                <group>
                                    <group>
                                        <label for="activity_duration"/>
                                        <div>
                                            <field name="activity_duration"
                                                   widget="float_time"
                                                   class="oe_inline"/> <span class="ml8">hours</span>
                                        </div>
                                    </group>
                                    <group>
                                        <field name="activity_system_class_id"
                                               options="{'no_open': True, 'no_create': True}"/>
                                    </group>
                                </group>
                                <notebook>
                                    <page name="description_page" string="Description">
                                        <field name="activity_description" type="html"/>
                                        <div class="d-none oe_clear"/>
                                    </page>
                                    <page name="activity_urls" string="Links">
                                        <field
                                                name="activity_url_ids"
                                                widget="section_and_note_one2many"
                                                context="{'default_activity_id' : id}"
                                                mode="tree,form">

                                            <tree string="Activies Lines"
                                                  editable="bottom">
                                                <field name="name" widget="url"/>
                                                <field name="description"/>
                                            </tree>
                                        </field>
                                    </page>

                                    <page name="activity_files" string="Files">
                                        <group>
                                            <field name="activity_att_documents" widget="many2many_binary"/>
                                        </group>
                                    </page>
                                </notebook>
                            </page>

                            <page string="Timesheets" name="timesheets">

                                <group>
                                    <group>
                                        <div class="o_td_label">
                                            <label for="planned_hours" string="Initially Planned Hours"
                                                   attrs="{'invisible': [('encode_uom_in_days', '=', True)]}"/>
                                            <label for="planned_hours" string="Initially Planned Days"
                                                   attrs="{'invisible': [('encode_uom_in_days', '=', False)]}"/>
                                        </div>
                                        <field name="duration_compute" widget="float_time" invisible="1"/>
                                        <field name="planned_hours"
                                               widget="timesheet_uom_no_toggle" nolabel="1"/>
                                    </group>
                                    <group>
                                        <field name="progress" widget="progressbar"/>
                                    </group>
                                </group>

                                <field name='timesheet_ids' mode="tree,kanban"
                                       context="{'default_task_request_id': id, 'default_flag_req_account_id': False}">
                                    <tree editable="bottom" string="Timesheet Activities" default_order="date">
                                        <field name="datetime_create_line" invisible="1"/>
                                        <field name="datetime_start" invisible="1"/>
                                        <field name="date"/>
                                        <field name="user_id" invisible="1"/>
                                        <field name="employee_id" required="1" widget="many2one_avatar_employee"/>
                                        <field name="flag_req_account_id" invisible="1"/>
                                        <field name="account_id" optional="hide"
                                               attrs="{'required': [('flag_req_account_id', '=', True)]}"/>
                                        <field name="name" required="1"/>
                                        <field name="unit_amount" widget="timesheet_uom"
                                               decoration-danger="unit_amount &gt; 24"/>
                                        <field name="task_request_id" invisible="1"/>
                                        <field name="company_id" invisible="1"/>
                                    </tree>

                                    <kanban class="o_kanban_mobile">
                                        <field name="date"/>
                                        <field name="user_id"/>
                                        <field name="employee_id"/>
                                        <field name="name"/>
                                        <field name="unit_amount"/>
                                        <field name="task_request_id"/>
                                        <templates>
                                            <t t-name="kanban-box">
                                                <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                                    <div class="row">
                                                        <div class="col-6">
                                                            <strong><span><t
                                                                    t-esc="record.employee_id.value"/></span></strong>
                                                        </div>
                                                        <div class="col-6 pull-right text-right">
                                                            <strong><t t-esc="record.date.value"/></strong>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-6 text-muted">
                                                            <span><t t-esc="record.name.value"/></span>
                                                        </div>
                                                        <div class="col-6">
                                                            <span class="pull-right text-right">
                                                                <field name="unit_amount" widget="float_time"
                                                                       decoration-danger="unit_amount &gt; 24"/>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </t>
                                        </templates>
                                    </kanban>
                                    <form string="Timesheet Activities">
                                        <sheet>
                                            <group>
                                                <field name="date"/>
                                                <field name="user_id" invisible="1"/>
                                                <field name="employee_id" required="1"/>
                                                <field name="name"/>
                                                <field name="unit_amount" string="Duration" widget="float_time"
                                                       decoration-danger="unit_amount &gt; 24"/>
                                                <field name="task_request_id" invisible="1"/>
                                                <field name="company_id" invisible="1"/>
                                            </group>
                                        </sheet>
                                    </form>
                                </field>
                                <group>
                                    <group class="oe_subtotal_footer oe_right" name="ticket_hours">
                                        <field name="encode_uom_in_days" invisible="1"/>
                                        <span>
                                            <label class="font-weight-bold" for="total_hours_spent" string="Hours Spent"
                                                   attrs="{'invisible': [('encode_uom_in_days', '=', True)]}"/>
                                            <label class="font-weight-bold" for="total_hours_spent" string="Days Spent"
                                                   attrs="{'invisible': [('encode_uom_in_days', '=', False)]}"/>
                                        </span>
                                        <field name="total_hours_spent" widget="timesheet_uom" nolabel="1"/>
                                    </group>
                                </group>
                            </page>

                            <page name="employee_additional"
                                  attrs="{'invisible': [('flag_readonly', '=', True)]}"
                                  string="Employees additional">
                                <group>
                                    <field name="employee_additional_ids"
                                           domain="[('id', '!=', employee_id),
                                                    ('speciality_ids','!=', False)]"
                                           nolabel="1"
                                           options="{'no_create': True, 'no_open': True}"
                                           widget="many2many_tags"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"
                               options="{'post_refresh':True}"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>


        <!-- Form View for kanban quick create -->
        <record id="maintenance_request_task_view_form_minimal" model="ir.ui.view">
            <field name="name">maintenance_request_task_view_form_minimal</field>
            <field name="model">maintenance.request.task</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="request_id"/>
                        <field name="employee_id"/>
                        <field name="activity_id"/>
                        <field name="company_id" groups="base.group_multi_company"/>
                    </group>
                </form>
            </field>
        </record>
        <!-- Project Task Kanban View -->
        <record model="ir.ui.view" id="maintenance_request_view_task_kanban">
            <field name="name">maintenance.request.task.kanban</field>
            <field name="model">maintenance.request.task</field>
            <field name="arch" type="xml">
                <kanban ddefault_order="planned_date_begin"
                        default_group_by="planned_date_begin:day"
                        group_create="0"
                        on_create="quick_create"
                        quick_create_view="l10n_cl_maintenance.maintenance_request_task_view_form_minimal"
                        sample="1">
                    <field name="color"/>
                    <field name="priority"/>
                    <field name="stage_id" options='{"group_by_tooltip":
                    {"description": "Description"}}'/>
                    <field name="user_id"/>
                    <field name="employee_id"/>
                    <field name="request_id"/>
                    <field name="sequence"/>
                    <field name="is_closed"/>
                    <field name="active"/>
                    <field name="legend_blocked"/>
                    <field name="legend_normal"/>
                    <field name="legend_done"/>
                    <field name="activity_ids"/>
                    <field name="activity_state"/>
                    <field name="rating_last_value"/>
                    <field name="rating_ids"/>
                    <field name="planned_date_begin"/>

                    <progressbar field="kanban_state"
                                 colors='{"done": "success", "blocked": "danger", "normal": "muted"}'/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="{{!selection_mode ? 'oe_kanban_color_' + kanban_getcolor(record.color.raw_value) : ''}} oe_kanban_card oe_kanban_global_click">
                                <div class="oe_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title"><field name="name"/></strong>
                                            <span invisible="context.get('default_task_request_id', False)"><br/><field
                                                    name="request_id" required="1"/></span>
                                            <br/>
                                            <t t-if="record.employee_id.value">
                                                <span>
                                                    <field name="employee_id"/>
                                                </span>
                                            </t>
                                        </div>
                                        <div class="o_dropdown_kanban dropdown" t-if="!selection_mode">
                                            <a role="button" class="dropdown-toggle o-no-caret btn"
                                               data-toggle="dropdown"
                                               data-display="static" href="#" aria-label="Dropdown menu"
                                               title="Dropdown menu">
                                                <span class="fa fa-ellipsis-v"/>
                                            </a>
                                            <div class="dropdown-menu" role="menu">
                                                <a t-if="widget.editable" role="menuitem" type="edit"
                                                   class="dropdown-item">
                                                    Edit</a>
                                                <a t-if="widget.editable" role="menuitem" class="dropdown-item"
                                                   name="toggle_active" type="object">
                                                    <t t-if="record.active.raw_value">Archive</t>
                                                    <t t-if="!record.active.raw_value">Restore</t>
                                                </a>
                                                <a t-if="widget.deletable" role="menuitem" type="delete"
                                                   class="dropdown-item">Delete</a>
                                                <div role="separator" class="dropdown-divider"></div>
                                                <ul class="oe_kanban_colorpicker" data-field="color"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_body">

                                    </div>
                                    <div class="o_kanban_record_bottom" t-if="!selection_mode">
                                        <div class="oe_kanban_bottom_left">
                                            <field name="priority" widget="priority"/>
                                            <field name="activity_ids" widget="kanban_activity"/>
                                            <b t-if="record.rating_ids.raw_value.length">
                                                <span style="font-weight:bold;"
                                                      class="fa fa-fw mt4 fa-smile-o text-success"
                                                      t-if="record.rating_last_value.value == 5"
                                                      title="Latest Rating: Satisfied" role="img"
                                                      aria-label="Happy face"/>
                                                <span style="font-weight:bold;"
                                                      class="fa fa-fw mt4 fa-meh-o text-warning"
                                                      t-if="record.rating_last_value.value == 3"
                                                      title="Latest Rating: Not Satisfied" role="img"
                                                      aria-label="Neutral face"/>
                                                <span style="font-weight:bold;"
                                                      class="fa fa-fw mt4 fa-frown-o text-danger"
                                                      t-if="record.rating_last_value.value == 1"
                                                      title="Latest Rating: Higly Dissatisfied" role="img"
                                                      aria-label="Sad face"/>
                                            </b>
                                            <div name="date_deadline" attrs="{'invisible': [('is_closed', '=', True)]}">
                                                <field name="date_deadline" widget="remaining_days"/>

                                                <t t-if="record.planned_date_begin.raw_value">
                                                    <t>
                                                        <t t-set="deadline_class" t-value=""/>
                                                        <t t-if="record.planned_date_begin.raw_value and moment(record.planned_date_begin.raw_value.toISOString()).startOf('day') lt moment().startOf('day')"
                                                           t-set="deadline_class" t-value="'oe_kanban_text_red'"/>
                                                        <t t-elif="record.planned_date_begin.raw_value and moment(record.planned_date_begin.raw_value.toISOString()).startOf('day') lt moment().endOf('day')"
                                                           t-set="deadline_class"
                                                           t-value="'text-warning font-weight-bold'"/>
                                                        <t t-set="date_format" t-value="'MM/DD/YY'"/>
                                                    </t>
                                                    <t>
                                                        <t t-set="deadline_class"></t>
                                                        <t t-if="record.planned_date_begin.raw_value and moment(record.planned_date_begin.raw_value.toISOString()) lt moment()"
                                                           t-set="deadline_class" t-value="'oe_kanban_text_red'"/>
                                                        <t t-set="date_format" t-value="'HH:mm A'"/>
                                                    </t>
                                                    <span name="date" title="Start Date"
                                                          t-attf-class="#{deadline_class || ''}"><t
                                                            t-esc="moment(record.planned_date_begin.raw_value.toISOString()).format(date_format)"/></span>
                                                </t>
                                            </div>
                                        </div>
                                        <div class="oe_kanban_bottom_right" t-if="!selection_mode">
                                            <field name="kanban_state"
                                                   widget="state_selection"/>
                                            <field name="user_id" widget="many2one_avatar_user"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="oe_clear"></div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>


        <record id="maintenance_request_task_view_tree" model="ir.ui.view">
            <field name="name">maintenance_request_task_view_tree</field>
            <field name="model">maintenance.request.task</field>
            <field name="arch" type="xml">
                <tree string="maintenance_request_task_tree">
                    <field name="name"/>
                    <field name="request_id"/>
                    <field name="employee_id" widget="many2one_avatar_employee"/>
                    <!--                    <field name="activity_id"/>-->
                    <field name="stage_id"/>
                    <field name="activity_ids" widget="list_activity" optional="show"/>
                    <field name="company_id" optional="show" groups="base.group_multi_company" readonly="1"/>
                </tree>
            </field>
        </record>


        <record id="request_task_view_calendar" model="ir.ui.view">
            <field name="name">maintenance.request.task.calendar.fsm</field>
            <field name="model">maintenance.request.task</field>
            <field name="arch" type="xml">
                <calendar date_start="planned_date_begin"
                          date_stop="planned_date_end"
                          string="Tasks" mode="month"
                          color="user_id" event_open_popup="1"
                          form_view_id="%(l10n_cl_maintenance.maintenance_request_task_view_form_minimal)d"
                          quick_add="0"> <!--    -->
                    <field name="user_id" invisible="1" filters="1"/>
                    <field name="name"/>
                    <field name="employee_id"/>
                </calendar>
            </field>
        </record>

        <record id="request_task_view_gantt" model="ir.ui.view">
            <field name="name">maintenance.request.task.view.gantt</field>
            <field name="model">maintenance.request.task</field>
            <field name="priority">10</field>
            <field name="arch" type="xml">
                <gantt date_start="planned_date_begin"
                       date_stop="planned_date_end"
                       default_scale="week"
                       scales="day,week,month,year"
                       string="Planning"
                       thumbnails="{'user_id': 'image_128'}"
                       js_class="task_gantt"
                       display_unavailability="1"
                       sample="1"
                       precision="{'day': 'hour:quarter',
                                   'week': 'day:half',
                                   'month': 'day:full'}">
                    <templates>
                        <div t-name="gantt-popover" class="container-fluid">
                            <div class="row no-gutters">
                                <div class="col">
                                    <ul class="pl-1 mb-0">
                                        <li><strong>Start Date: </strong> <t
                                                t-esc="userTimezoneStartDate.format('L LTS')"/></li>
                                        <li><strong>Stop Date: </strong> <t
                                                t-esc="userTimezoneStopDate.format('L LTS')"/></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </templates>
                    <field name="employee_id"/>
                </gantt>
            </field>
        </record>

        <record id="request_task_view_activity" model="ir.ui.view">
            <field name="name">maintenance.request.task.activity</field>
            <field name="model">maintenance.request.task</field>
            <field name="arch" type="xml">
                <activity string="Request Tasks">
                    <field name="user_id"/>
                    <templates>
                        <div t-name="activity-box">
                            <img t-att-src="activity_image('res.users', 'image_128', record.user_id.raw_value)"
                                 t-att-title="record.user_id.value" t-att-alt="record.user_id.value"/>
                            <div>
                                <field name="name" display="full"/>
                                <field name="request_id" muted="1" display="full"
                                       invisible="context.get('default_request_id', False)"/>
                            </div>
                        </div>
                    </templates>
                </activity>
            </field>
        </record>

        <record id="view_request_task_pivot" model="ir.ui.view">
            <field name="name">maintenance.request.task.pivot</field>
            <field name="model">maintenance.request.task</field>
            <field name="arch" type="xml">
                <pivot string="Request Tasks" sample="1">
                    <field name="request_id" type="row"/>
                    <field name="stage_id" type="col"/>
                    <field name="color" invisible="1"/>
                </pivot>
            </field>
        </record>

        <record id="view_request_task_graph" model="ir.ui.view">
            <field name="name">maintenance.request.task.graph</field>
            <field name="model">maintenance.request.task</field>
            <field name="arch" type="xml">
                <graph string="Request Tasks" sample="1">
                    <field name="request_id"/>
                    <field name="stage_id"/>
                </graph>
            </field>
        </record>

        <record id="maintenance_request_task_view_search" model="ir.ui.view">
            <field name="name">maintenance.request.task.search</field>
            <field name="model">maintenance.request.task</field>
            <field name="arch" type="xml">
                <search string="Search planning">
                    <field name="name" string="Tasks"/>
                    <field name="employee_id"/>
                    <field name="user_id"/>
                    <field name="active"/>
                    <filter string="My Tasks" name="my_tasks" domain="[('user_id', '=', uid)]"/>
                    <separator/>
                    <filter string="To Schedule" name="schedule"
                            domain="[
                                    '|',
                                        ('user_id', '=', False),
                                    '&amp;',
                                        ('planned_date_begin', '=', False),
                                        ('planned_date_end', '=', False)
                                ]"/>
                    <filter string="To Do" name="todo"
                            domain="[('user_id', '!=', False),
                                     ('planned_date_begin', '!=', False),
                                     ('planned_date_end', '!=', False)]"/>
                    <separator/>
                    <filter string="Archived" name="inactive" domain="[('active', '=', False)]"/>
                    <filter name="planned_today" string="Planned for Today" domain="[
                        ('planned_date_begin','&lt;=', datetime.datetime.combine(context_today(), datetime.time(23,59,59))),
                        ('planned_date_begin','&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"/>
                    <filter name="planned_future" string="Future"
                            domain="[('planned_date_begin', '>=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"/>
                    <group expand="0" string="Group By">
                        <filter string="Responsible" name="groupby_user" context="{'group_by':'user_id'}"/>
                        <filter string="Stage" name="groupby_stage" context="{'group_by':'stage_id'}"/>
                        <filter string="Request" name="groupby_request" context="{'group_by':'request_id'}"/>
                        <filter string="Company" name="groupby_company" context="{'group_by':'company_id'}"
                                groups="base.group_multi_company"/>
                        <filter string="Start Date" name="groupby_planned_date_begin"
                                context="{'group_by': 'planned_date_begin:day'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!--  ================== vista desde la solicitud (inicio) ================== -->

        <record id="maintenance_request_task_admin_view_tree" model="ir.ui.view">
            <field name="name">maintenance_request_task_admin_view_tree</field>
            <field name="model">maintenance.request.task</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name_seq" string="Name" readonly="1"/>
                    <field name="flag_create_task" invisible="1"/>
                    <field name="flag_from_request" invisible="1"/>
                    <field name="request_id"
                           attrs="{'readonly': ['|', ('flag_create_task', '=', True),
                            ('flag_from_request', '=', True)]}"
                           options="{'no_create': True, 'no_create_edit': True, 'no_open': False}"/>

                    <field name="activity_id" required="1"/>
                    <field name="activity_speciality_ids" widget="many2many_tags"
                           options="{'color_field': 'color'}"/>
                    <field name="employee_id"
                           domain="[('speciality_ids', 'in', activity_speciality_ids)]"
                           options="{'no_create': True, 'no_create_edit': True, 'no_open': False}"
                           widget="many2one_avatar_employee"/>
                    <field name="stage_id"/>

                    <field name="activity_ids" widget="list_activity" optional="hide"/>
                    <field name="company_id" optional="show" groups="base.group_multi_company" readonly="1"/>

                </tree>
            </field>
        </record>


        <record id="maintenance_request_task_admin_action" model="ir.actions.act_window">
            <field name="name">Tasks</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">maintenance.request.task</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="l10n_cl_maintenance.maintenance_request_task_admin_view_tree"/>
            <field name="search_view_id" ref="maintenance_request_task_view_search"/>
        </record>

        <!--  ================== vista desde la solicitud (fin) ================== -->


        <record id="maintenance_request_task_action" model="ir.actions.act_window">
            <field name="name">Maintenance Request Task</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">maintenance.request.task</field>
            <field name="view_mode">kanban,gantt,calendar,tree,form,activity</field>
            <field name="search_view_id" ref="maintenance_request_task_view_search"/>
            <field name="view_id" ref="l10n_cl_maintenance.maintenance_request_task_view_tree"/>
            <field name="domain">[('user_id', '=', uid), ('request_id.stage_id', '=', 2)]</field>

            <field name="context">{
                'show_address': False,
                'search_default_my_tasks': False,
                'search_default_planned_future': False,
                'search_default_planned_today': False,
                'search_default_groupby_request': True,
            }</field>

            <field name="help" type="html">
                <p class='o_view_nocontent_smiling_face'>No tasks found. Let's create one!</p>
                <p>Find here your tasks planned for the following days.</p>
            </field>
        </record>

        <record id="maintenance_request_task_user_action" model="ir.actions.act_window">
            <field name="name">Maintenance Request Task</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">maintenance.request.task</field>
            <field name="view_mode">kanban,gantt,calendar,tree,form,activity</field>
            <field name="search_view_id" ref="maintenance_request_task_view_search"/>
            <field name="domain">[('user_id', '=', uid), ('request_id.stage_id', '=', 2)]</field>
            <field name="context">{}</field>

            <field name="help" type="html">
                <p class='o_view_nocontent_smiling_face'>No tasks found. Let's create one!</p>
                <p>Find here your tasks planned for the following days.</p>
            </field>
        </record>


        <record id="request_task_action_all" model="ir.actions.act_window">
            <field name="name">All Tasks</field>
            <field name="res_model">maintenance.request.task</field>
            <field name="view_mode">tree,kanban,gantt,calendar,pivot,graph,form,activity</field>
            <field name="search_view_id" ref="maintenance_request_task_view_search"/>
            <field name="context">{
                'default_user_id': False,
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No tasks found. Let's create one!
                </p>
                <p>
                    To get things done, use activities and status on tasks.
                    <br/>
                    Chat in real time or by email to collaborate efficiently.
                </p>
            </field>
        </record>


        <!-- All Tasks: to schedule action -->
        <record id="request_task_action_to_schedule" model="ir.actions.act_window">
            <field name="name">To Schedule</field>
            <field name="res_model">maintenance.request.task</field>
            <field name="view_mode">tree,kanban,gantt,calendar,pivot,graph,form,activity</field>
            <field name="search_view_id" ref="maintenance_request_task_view_search"/>
            <field name="domain">[]</field>
            <field name="context">{
                'search_default_schedule': True,
                'default_user_id': False,
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No tasks found. Let's create one!
                </p>
                <p>Schedule tasks and assign them to your workers.</p>
            </field>
        </record>


        <!-- Planning : by users -->
        <record id="request_task_action_planning_groupby_user" model="ir.actions.act_window">
            <field name="name">Planning by User</field>
            <field name="res_model">maintenance.request.task</field>
            <field name="view_mode">gantt,kanban,tree,calendar,form,activity</field>
            <field name="search_view_id" ref="maintenance_request_task_view_search"/>
            <field name="domain">[]</field>
            <field name="context" eval="{'search_default_groupby_user': 1, 'task_nameget_with_hours': 1}"/>
            <field name="help" type="html">
                <p class='o_view_nocontent_smiling_face'>
                    No tasks found
                </p>
                <p>
                    Let's start your planning by adding a new task.
                </p>
            </field>
        </record>


        <!-- Planning : by request -->
        <record id="request_task_action_planning_groupby_request" model="ir.actions.act_window">
            <field name="name">Planning by Request</field>
            <field name="res_model">maintenance.request.task</field>
            <field name="view_mode">kanban,tree,calendar,pivot,graph,activity</field>
            <field name="search_view_id" ref="maintenance_request_task_view_search"/>
            <field name="domain">[]</field>
            <field name="context"
                   eval="{'search_default_groupby_request': 1, 'search_default_groupby_user': 2, 'task_nameget_with_hours': 1}"/>
            <field name="help" type="html">
                <p class='o_view_nocontent_smiling_face'>
                    No tasks found
                </p>
                <p>
                    Let's start your planning by adding a new task.
                </p>
            </field>
        </record>


        <!--    reports-->
        <record id="request_task_user_view_pivot" model="ir.ui.view">
            <field name="name">report.request.task.user.pivot</field>
            <field name="model">report.request.task.user</field>
            <field name="arch" type="xml">
                <pivot string="Tasks Analysis" display_quantity="true" disable_linking="True" sample="1">
                    <field name="request_id" type="row"/>
                </pivot>
            </field>
        </record>

        <record id="request_task_user_view_graph" model="ir.ui.view">
            <field name="name">report.request.task.user.graph</field>
            <field name="model">report.request.task.user</field>
            <field name="arch" type="xml">
                <graph string="Tasks Analysis" type="bar" sample="1" disable_linking="1">
                    <field name="request_id" type="row"/>
                    <field name="user_id" type="col"/>
                    <field name="nbr" type="measure"/>
                </graph>
            </field>
        </record>


        <record id="view_task_request_user_search" model="ir.ui.view">
            <field name="name">report.request.task.user.search</field>
            <field name="model">report.request.task.user</field>
            <field name="arch" type="xml">
                <search string="Tasks Analysis">
                    <field name="name"/>
                    <field name="date_assign"/>
                    <field name="date_end"/>
                    <field name="date_deadline"/>
                    <field name="date_last_stage_update"/>
                    <field name="request_id"/>
                    <field name="user_id"/>
                    <!--                <field name="partner_id" filter_domain="[('partner_id', 'child_of', self)]"/>-->
                    <field name="stage_id"/>
                    <filter string="Unassigned" name="unassigned" domain="[('user_id', '=', False)]"/>
                    <separator/>
                    <filter name="filter_date_deadline" date="date_deadline"/>
                    <filter name="filter_date_assign" date="date_assign"/>
                    <filter name="filter_date_last_stage_update" date="date_last_stage_update"/>
                    <group expand="0" string="Extended Filters">
                        <field name="priority"/>
                        <field name="company_id" groups="base.group_multi_company"/>
                    </group>
                    <group expand="1" string="Group By">
                        <filter string="Request" name="request" context="{'group_by': 'request_id'}"/>
                        <filter string="Assigned to" name="User" context="{'group_by': 'user_id'}"/>
                        <filter string="Stage" name="Stage" context="{'group_by': 'stage_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="request_task_user_action_report" model="ir.actions.act_window">
            <field name="name">Tasks Analysis</field>
            <field name="res_model">report.request.task.user</field>
            <field name="view_mode">graph,pivot</field>
            <field name="search_view_id" ref="view_task_request_user_search"/>
            <field name="context">{'group_by_no_leaf': 1, 'group_by': []}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_empty_folder">
                    No data yet!
                </p>
                <p>
                    Create tasks to get statistics.
                </p>
            </field>
        </record>


        <record id="product_action_request" model="ir.actions.act_window">
            <field name="name">Products</field>
            <field name="res_model">product.template</field>
            <field name="view_mode">kanban,tree,activity,form</field>
            <field name="domain">[('sale_ok', '=', True)]</field>
            <field name="context">{
                'search_default_filter_to_sell': True,
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No products found. Let's create one!
                </p>
                <p>
                    Track and reinvoice the material used to complete an intervention.
                </p>
            </field>
        </record>

    </data>
</odoo>