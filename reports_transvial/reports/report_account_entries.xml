<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <template id="report_account_entries_view">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <style>
                                .vertical {
                                border-left: 1px solid black;
                                height: 100px;
                                position:absolute;
                                left: 50%;
                                }

                                .line-top{
                                border-top: 0.1em solid #000 !important;
                                }
                                .line-bottom{
                                border-bottom: 0.1em solid #000 !important;
                                }

                                .fond-black{
                                font-weight: 900 !important;
                                }

                                table { page-break-after:auto }
                                tr { page-break-inside:avoid; page-break-after:auto }
                                td { page-break-inside:avoid; page-break-after:auto }
                                thead { display: table-row-group; }
                            </style>

                            <t t-set="o" t-value="o.with_context(lang=lang)"/>
                            <div class="page">
                                <!--                                <br/>-->
                                <!--                                <br/>-->
                                <h4>
                                    <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">Factura</span>
                                    <span t-if="o.move_type == 'out_invoice' and o.state == 'draft'">Factura
                                        Borrador</span>
                                    <span t-if="o.move_type == 'out_invoice' and o.state == 'cancel'">Factura
                                        Cancelada</span>
                                    <span t-if="o.move_type == 'out_refund'">Nota de Crédito</span>
                                    <span t-if="o.move_type == 'in_refund'">Nota de Crédito de Proveedor</span>
                                    <span t-if="o.move_type == 'in_invoice'">Factura de Proveedor</span>
                                    <span t-if="o.name != '/'" t-field="o.name"/>
                                </h4>
                                <div id="informations" class="row mt32 mb32">
                                    <div class="col-auto col-3 mw-100 mb-2" t-if="o.name != '/'"
                                         name="name_seq_system">
                                        <strong>Correlativo:</strong>
                                        <p class="m-0" t-field="o.name"/>
                                    </div>
                                    <div class="col-auto col-3 mw-100 mb-2" t-if="o.partner_id" name="invoice_date">
                                        <t t-if="o.move_type == 'in_invoice'">
                                            <strong>Proveedor:</strong>
                                        </t>
                                        <t t-else=""><strong>Cliente:</strong></t>
                                        <p class="m-0" t-field="o.partner_id"/>

                                        <!--                                           t-options='{"widget": "contact", "fields": ["address", "name" ,"phone"], "no_marker": False}'-->
                                    </div>

                                    <div class="col-auto col-3 mw-100 mb-2" t-if="o.invoice_date" name="invoice_date">
                                        <strong>Fecha factura:</strong>
                                        <p class="m-0" t-field="o.invoice_date"/>
                                    </div>
                                    <div class="col-auto col-3 mw-100 mb-2"
                                         t-if="o.invoice_date_due"
                                         name="due_date">
                                        <strong>Fecha de vcto:</strong>
                                        <p class="m-0" t-field="o.invoice_date_due"/>
                                    </div>
                                    <div class="col-auto col-3 mw-100 mb-2" t-if="o.invoice_origin" name="origin">
                                        <strong>Origen:</strong>
                                        <p class="m-0" t-field="o.invoice_origin"/>
                                    </div>
                                    <div class="col-auto col-3 mw-100 mb-2" t-if="o.partner_id.ref"
                                         name="customer_code">
                                        <strong>Código del cliente:</strong>
                                        <p class="m-0" t-field="o.partner_id.ref"/>
                                    </div>
                                    <!--                                    <div class="col-auto col-3 mw-100 mb-2" t-if="o.l10n_latam_document_number" name="reference">-->
                                    <!--                                        <strong>Número de Doc:</strong>-->
                                    <!--                                        <p class="m-0" t-field="o.l10n_latam_document_number"/>-->
                                    <!--                                    </div>-->
                                    <div class="col-auto col-3 mw-100 mb-2" t-if="o.ref" name="reference">
                                        <strong>Referencía:</strong>
                                        <p class="m-0" t-field="o.ref"/>
                                    </div>
                                </div>
                                <span class="float-right text-small"
                                      t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>

                                <table class="table table-sm o_main_table table-bordered" name="line_ids_table">
                                    <thead>
                                        <tr class="table-active">
                                            <th class="text-center" colspan="6"><h5>Apuntes Contables</h5></th>
                                        </tr>
                                        <tr>
                                            <th class="text-left"><span>Cuenta</span></th>
                                            <th class="text-left"><span>Etiqueta</span></th>
                                            <th class="text-left"><span>Etiquetas analíticas</span></th>
                                            <th class="text-left"><span>T/C</span></th>
                                            <th class="text-right"><span>Debe</span></th>
                                            <th class="text-right"><span>Haber</span></th>
                                        </tr>
                                    </thead>
                                    <tbody class="invoice_tbody">
                                        <t t-set="total_debe" t-value="0"/>
                                        <t t-set="total_haber" t-value="0"/>
                                        <t t-set="lines"
                                           t-value="o.line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>

                                        <t t-foreach="lines" t-as="line">
                                            <t t-set="total_debe" t-value="total_debe + line.debit"/>
                                            <t t-set="total_haber" t-value="total_haber + line.credit"/>

                                            <tr>
                                                <td><span t-field="line.account_id"/></td>
                                                <td><span t-field="line.name" t-options="{'widget': 'text'}"/></td>
                                                <td>
                                                    <span t-esc="', '.join(map(str,line.analytic_tag_ids.mapped('name')))"
                                                    />
                                                </td>
                                                <td><span t-field="line.trm"/></td>
                                                <td class="text-right o_price_total"><span t-field="line.debit"/></td>
                                                <td class="text-right o_price_total"><span t-field="line.credit"/></td>
                                            </tr>

                                        </t>

                                        <tr class="border-black text-left text-small">
                                            <td colspan="4">
                                                <strong>SON: <span
                                                        t-esc="o.amount_to_text(total_debe, o.currency_pe_id)"
                                                /></strong><br/>
                                                <!--                                                <strong>SON (Ingreso)<span-->
                                                <!--                                                        t-esc="o.amount_to_text(total_haber, o.currency_pe_id)"-->
                                                <!--                                                /></strong>-->
                                            </td>
                                            <td class="text-right o_price_total">
                                                <strong><span t-esc="total_debe"
                                                              t-options='{"widget": "monetary", "display_currency": o.currency_pe_id}'
                                                /></strong>
                                            </td>

                                            <td class="text-right o_price_total">
                                                <strong><span t-esc="total_haber"
                                                              t-options='{"widget": "monetary", "display_currency": o.currency_pe_id}'
                                                /></strong>
                                            </td>
                                        </tr>

                                    </tbody>
                                </table>

                                <br/><br/><br/><br/>
                                <div id="firms" class="row">
                                    <div class="col-3">
                                        <ul style="list-style-type: none;">
                                            <li class="text-center fond-black line-top">
                                                Procesado por</li>
                                        </ul>
                                        <!--                                        <div class="vertical"></div>-->
                                    </div>
                                    <div class="col-3">
                                        <ul style="list-style-type: none; ">
                                            <li class="text-center fond-black line-top">
                                                Autorizado por</li>
                                        </ul>
                                    </div>
                                    <div class="col-3">
                                        <ul style="list-style-type: none; ">
                                            <li class="text-center fond-black line-top">
                                                Revisado por</li>
                                        </ul>
                                    </div>
                                    <div class="col-3">
                                        <ul style="list-style-type: none; ">
                                            <li class="text-center fond-black line-top">
                                                Recibi conforme</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <br/>
                            <div id="footer_demo" class="row mt32 mb32 float-right">
                                <div class="col-auto col-3 mw-100 mb-2">
                                    <strong>Usuario: </strong><span class="m-0" t-field="o.user_id"/>
                                </div>
                            </div>

                        </div>
                    </t>
                </t>
            </t>
        </template>


        <record id="transvial_entries_a4_paperformat" model="report.paperformat">
            <field name="name">Asientos contables: A4</field>
            <field name="default" eval="True"/>
            <field name="format">A4</field>
            <field name="page_height">0</field>
            <field name="page_width">0</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">35</field>
            <field name="margin_bottom">25</field>
            <field name="margin_left">7</field>
            <field name="margin_right">7</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">35</field>
            <field name="dpi">90</field>
        </record>

        <report
                id="action_report_account_entries"
                model="account.move"
                string="Apuntes contables"
                name="reports_transvial.report_account_entries_view"
                file="pe_edi_detraction.report_account_entries"
                report_type="qweb-pdf"
                paperformat="reports_transvial.transvial_entries_a4_paperformat"
        />

    </data>
</odoo>